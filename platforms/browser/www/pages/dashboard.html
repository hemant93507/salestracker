<template>
  <div class="page">
    <div class="navbar navbar-main bg-color-white color-green">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link icon-only panel-open" data-panel="left">
            <i class="icon material-icons">menu</i>
          </a>
        </div>
        <div class="title">Dashboard</div>
        <div class="right">
          <a href="#" data-popover=".dashboard-popover" class="popover-open link icon-only">
            <i class="icon material-icons">more_vert</i>
          </a>
        </div>
      </div>
    </div>
    <div class="toolbar tabbar">
      <div class="toolbar-inner">
        <a href="#tab-1" class="tab-link tab-link-active">Attendance</a>
        <a href="#tab-2" class="tab-link">Site Visits</a>
      </div>
    </div>
    <div class="tabs-animated-wrap">
      <div class="tabs">
        <div id="tab-1" class="page-content tab tab-active">
          <div class="block">
            <div class="row">
              <div class="col text-align-center">
                <div class="gauge gauge-init attendance-gauge" data-type="circle"
                  data-value="{{AttendancePercentage/100}}" data-value-text="{{AttendancePercentage}}%"
                  data-value-text-color="#4caf50" data-value-font-size="36" data-value-font-weight="700"
                  data-border-width="20" data-label-text="Attendance Today" data-border-color="#4caf50"
                  data-border-bg-color="#ffeb3b" data-bg-color="#ffffff">
                </div>
              </div>
              <div class="col text-align-center">
                <div class="list no-hairlines">
                  <ul>
                    <li>
                      <a href="{{PresentLink}}" class="item-link item-content">
                        <div class="item-inner">
                          <div class="item-title">Present</div>
                          <div class="item-after">{{Present}}</div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="{{AbsentLink}}" class="item-link item-content">
                        <div class="item-inner">
                          <div class="item-title">Absent</div>
                          <div class="item-after">{{Absent}}</div>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="block-title font-16" style="padding-left:8px">Attendance Today</div>
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th class="label-cell color-green">Employee ID</th>
                  <th class="label-cell color-green">Employee Name</th>
                  <th class="label-cell color-green">Check-In</th>
                  <th class="label-cell color-green">Check-Out</th>
                  <th class="label-cell color-green">Checkin Location</th>
                  <th class="label-cell color-green">Checkout Location</th>
                </tr>
              </thead>
              <tbody>
                {{#if Present}}
                {{#each PresentEmployeeList}}
                <tr>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{user_id}}</a></td>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{name}}</a></td>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{check_in}}</a></td>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{check_out}}</a></td>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{location}}</a></td>
                  <td class="label-cell"><a href="/employee-detail/{{email}}/" class="link color-blue">{{js "NA(this.checkout_location)"}}</a></td>
                </tr>
                {{/each}}
                {{else}}
                <tr>
                  <td colspan="4" class="label-cell">No records found!</td>
                </tr>
                {{/if}}
              </tbody>
            </table>
          </div>
        </div>
        <div id="tab-2" class="page-content tab">
          <!-- <div class="block-title font-16">Today's Stats</div> -->
          <!-- <div class="block no-margin">
            <div class="row">
              <div class="col text-align-center">
                <div class="list no-margin no-hairlines">
                  <ul>
                    <li>
                      <a href="{{MaximumVisitLink}}" class="item-link item-content">
                        <div class="item-inner">
                          <div class="item-title">Maximum Visits</div>
                          <div class="item-after">{{MaximumVisitCount}}</div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="{{MinimumVisitLink}}" class="item-link item-content">
                        <div class="item-inner">
                          <div class="item-title">Minimum Visits</div>
                          <div class="item-after">{{MinimumVisitCount}}</div>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div> -->
          <div class="block-title font-16">Visits Today</div>
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <!-- <th class="label-cell color-green">Party Name</th>
                  <th class="label-cell color-green">Contact Name</th>
                  <th class="label-cell color-green">Party Email</th>
                  <th class="label-cell color-green">Party Phone</th>
                  <th class="label-cell color-green">Party Address</th>
                  <th class="label-cell color-green">Location</th> -->

                  <th class="label-cell color-green">Employee Name</th>
                  <th class="label-cell color-green">Firm Name</th>
                  <th class="label-cell color-green">Check In</th>
                  <th class="label-cell color-green">Location</th>
                  <th class="label-cell color-green">Check Out</th>
                  <th class="label-cell color-green">Location</th>
                </tr>
              </thead>
              <tbody>
                <!-- {{#if MinimumVisitCount}} -->
                {{#if PartyVisitList}}
                {{#each PartyVisitList}}
                <!-- <tr>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{party_name}}</a></td>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{contact_name}}</a></td>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{party_email}}</a></td>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{party_phone}}</a></td>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{party_address}}</a></td>
                  <td class="label-cell"><a href="/party-detail/{{party_email}}/"
                      class="link color-blue">{{location}}</a></td>
                </tr> -->
                <tr>
                  <td class="label-cell">{{name}}</td>
                  <td class="label-cell">{{firm_name}}</td>
                  <td class="label-cell">{{check_in}}</td>
                  <td class="label-cell">{{checkin_location}}</td>
                  <td class="label-cell">{{check_out}}</td>
                  <td class="label-cell">{{checkout_location}}</td>
                </tr>
                {{/each}}
                {{else}}
                <tr>
                  <td colspan="4" class="label-cell">No records found!</td>
                </tr>
                {{/if}}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="popover dashboard-popover">
      <div class="popover-inner">
        <div class="list">
          <ul>
            <li><a class="color-black list-button item-link popover-close" href="#" onclick="shareApp()">Share App</a>
            </li>
            <li><a @click="logout" class="color-black list-button item-link popover-close" href="#">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="page-content">

    </div>
  </div>
</template>
<script>
  return {
    data: function () {
      var self = this;
      var data = JSON.parse(localStorage.User);
      var obj = {
        email: data.User.email,
      };
      app.request({
        url: BaseURL + 'admin-dashboard',
        method: 'POST',
        dataType: 'json',
        data: obj,
        //contentType: 'application/json',
        beforeSend: function (xhr) {
          app.preloader.show();
        },
        success: function (data, status, xhr) {
          console.log(data);
          if (data.ErrorCode == '0') {
            var gauge = app.gauge.get('.attendance-gauge');
            gauge.update({
              labelText: 'amount of something',
              el: '.attendance-gauge',
              value: data.AttendancePercentage / 100,
              valueText: data.AttendancePercentage + '%',
              valueTextColor: '#4caf50',
              valueFontSize: '36',
              valueFontWeight: '700',
              borderWidth: '20',
              labelText: 'Attendance Today',
              borderColor: '#4caf50',
              borderBgColor: '#ffeb3b',
              bgColor: '#ffffff',
            });

            var PresentLink = '#';
            var AbsentLink = '#';
            var MaximumVisitLink = '#';
            var MinimumVisitLink = '#';

            if (data.MaximumVisitCount > 0) {
              MaximumVisitLink = '/max-visits/';
            }
            if (data.MinimumVisitCount > 0) {
              MinimumVisitLink = '/min-visits/';
            }
            if (data.Present > 0) {
              PresentLink = '/present-today/';
            }
            if (data.Absent > 0) {
              AbsentLink = '/absent-today/';
            }

            self.$setState({
              Absent: data.Absent,
              Present: data.Present,
              AttendancePercentage: data.AttendancePercentage,
              PresentEmployeeList: data.PresentEmployeeList,
              PartyVisitList: data.PartyVisitList,
              MaximumVisitCount: data.MaximumVisitCount,
              MinimumVisitCount: data.MinimumVisitCount,
              MaximumVisitLink: MaximumVisitLink,
              MinimumVisitLink: MinimumVisitLink,
              PresentLink: PresentLink,
              AbsentLink: AbsentLink,
            });
          }
        },
        complete: function (xhr, status) {
          app.preloader.hide();
        }
      })
    },
    on: {
      pageInit: function () {
        // $$('.panel-left .profile-menu a').attr('href','/admin-profile/');
        // $$('.panel-left .profile-menu .item-title').text('My Profile');
        //$$('.clientvisit-menu,.attendance-menu').hide();
        $$('.panel-left .attendance-menu a').attr('href','/attendance-adminview/');
        $$('.panel-left .clientvisit-menu a').attr('href','/clientvisit-adminview/');
        $$('.employees-menu').show();
        $$('.clients-menu').show();
      }
    },
    methods: {
      logout: function () {
        localStorage.removeItem("User");
        app.views.main.router.navigate('/');
      }
    },
  }
</script>